<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ExamMaster — Mock Tests & PDFs</title>
  <script type="module" src="./config.js"></script>
  <script type="module" src="./purchase.js"></script>
  <script type="module" src="./login.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <h1>Available PDFs</h1>
  <div id="pdfList"></div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from "./config.js";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const pdfList = document.getElementById("pdfList");

    async function loadPDFs() {
      const { data, error } = await supabase.from("pdfs").select("*");
      if (error) {
        console.error(error);
        return;
      }

      pdfList.innerHTML = data.map(pdf => `
        <div style="border:1px solid #ccc;padding:10px;margin:10px;">
          <h3>${pdf.title}</h3>
          <p>Price: ₹${pdf.price}</p>
          <button onclick="buyPDF('${pdf.id}', '${pdf.title}', ${pdf.price})">Buy Now</button>
        </div>
      `).join('');
    }

    window.buyPDF = async (pdfId, pdfTitle, pdfPrice) => {
      localStorage.setItem("selected_pdf_id", pdfId);
      localStorage.setItem("selected_pdf_title", pdfTitle);
      localStorage.setItem("selected_pdf_price", pdfPrice);
      window.location.href = "purchase.html";
    };

    loadPDFs();
  </script>
</body>
</html>